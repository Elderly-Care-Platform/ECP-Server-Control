<script type="text/javascript">

</script>

<div class="container-fluid">
	<div id="wrapper" class="row-fluid">
		<h3 class='menu'>Edit {{currentDiscuss.discussType == 'A' &&
			'Article' || currentDiscuss.discussType == 'Q' && 'Question' ||
			'Post'}}</h3>
		<div class="alert alert-error" ng-show="error">{{errorMessage}}</div>

		

		<table style="width: 900px;">
			<tr ng-if="currentDiscuss.discussType == 'A'">
				<td><label class="control-label" for="title"><strong>Title</strong></label>
				</td>
				<td><input type="text" ng-model="currentDiscuss.title" id="title" required /></td>
			</tr>

			<tr ng-if="currentDiscuss.discussType == 'A'">
				<td><label class="control-label" for="title"><strong>Title Photo</strong></label></td>
				<td><form id="UploadImage12" action="UploadFile" method="post" enctype="multipart/form-data">
						<label class="myLabel" ng-style="{'background-image': 'url({{ currentDiscuss.articlePhotoFilename.original }})'}">
							<input name="sp" id="sp" type="file" required onchange="javascript:uploadImage(this)" /> 
							<span>Please upload<br> your main <br>photo (optional)
							</span>
						</label>
					</form> 
					<input type="text" id="articleTitleImage" ng-model="currentDiscuss.newArticlePhotoFilename" value="" style="display: none" onchange="javascript:previewImage(this)" />
					</td>
			</tr>

			<tr>
				<td><label class="control-label" for="title"><strong>Withdraw</strong></label>
				</td>
				<td><input type="checkbox" ng-model="currentDiscuss.status" name="status" ng-checked="currentDiscuss.status" id="status" style="vertical-align: top;"></td>
			</tr>

			<tr>
				<td><label class="control-label" for="title"><strong>Featured</strong></label>
				</td>
				<td><input type="checkbox" ng-model="currentDiscuss.featured" name="featured" ng-checked="currentDiscuss.featured" id="featured" style="vertical-align: top;"></td>
			</tr>

			<tr>
				<td colspan="2">
					<div class="controls">
						<a id="edit_text">Edit Text</a>
					</div>

					<div class="control-group">
						<label class="control-label" for="text"></label>
						<div class="controls byEditor" id="mce">
							<textarea data-ui-tinymce id="edittext" name="edittext" ng-model="currentDiscuss.text"></textarea>
						</div>
					</div>
				</td>
			</tr>

			<tr ng-repeat="newTag in allTags track by $index">
				<td><label class="control-label" for="title"><strong>Select
							Tags</strong></label></td>
				<td><input type="text" ng-model="allTags[$index]"
					typeahead="tag as tag.name for tag in existingTags | filter:{name: $viewValue} | limitTo:20"
					class="form-control"><a ng-click="removeTag($index)">REMOVE</a></td>
			</tr>
			
			<tr>
				<td colspan="2" style="text-align: right;">
				<a ng-click="editdiscuss()" class="btn btn-primary">Save Changes</a></td>
			</tr>

		</table>


		<div class="control-group" ng-hide="1">
			<label class="control-label" for="text"><strong>Text</strong></label>
			<div class="controls">
				<textarea id="texta" name="texta" rows="0" columns="0"
					ng-model="currentDiscuss.text">{{currentDiscuss.text}}</textarea>

			</div>
		</div>



		<script type="text/javascript">
		var isLoaded = false;
function uploadImage(input){
	if (input.files && input.files[0]) {
		previewImage(input);
		if(!isLoaded){
			$("#UploadImage12").bind('submit', function(e) {
	        	var postData = new FormData(jQuery('#UploadImage12')[0]);
	        	$.ajax(
	        		    {
	        		        url : 'UploadFile?transcoding=true',
	        		        type: "POST",
	        		        enctype:"multipart/form-data",
	        		        data : postData,
	        		      //  contentType: "application/json",
	        		        cache: false,
						    contentType: false,
						    processData: false,
	        		        success:function(data, textStatus, jqXHR) 
	        		        {
	        		            $("#articleTitleImage").val(JSON.stringify(data));
	        		            $("#articleTitleImage").trigger('input');
	        		        },
	        		        error: function(jqXHR, textStatus, errorThrown) 
	        		        {
	        		        	alert("Image upload failed");
	        		        }
	        		    });
	            e.preventDefault();
	      });
			isLoaded  = true;
		}
		
        $('#UploadImage12').submit();
        
        //input.form.submit();
    }
}


function previewImage(input) {
	var input = input || document.querySelector("input#sp");
	if ((input.files && input.files[0])||input.value) {
		var reader = new FileReader();
		reader.onload = function(e) {
			$('.myLabel').css('background-image',
					'url(' + e.target.result + ')')
		}

		reader.readAsDataURL(input.files[0] || input.value);
	}
}
	
		BYAdmin.addEditor({"editorTextArea":"edittext"});
		$('#edit_text').click(function() {
			editor_content = $('#texta').val();
			tinymce.activeEditor.setContent(editor_content);
		});
</script>